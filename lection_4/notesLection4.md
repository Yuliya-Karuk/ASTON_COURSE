### Event Loop
Event Loop - единственный механизм в JavaScript, который позволяет реализовать асинхронность (хотя по сути все операции выполняются синхронно, просто очень быстро, об этом далее). Event Loop является стеком, где хранятся все задачи, которые не вошли в синхронный поток выполнения. После завершения синхронного потока - задачи начинают выполняться из Event Loop'а. Однако у Event Loop'а тоже есть свои правила. Он делит все задачи на подтипы:

- Микрозадачи
- Макрозадачи
- Задачи отрисовки

Макрозадачами являются все асинхронные операции, такие как XmlHTTPRequest, setTimeout и так далее.

В микрозадачи попадают в основном только две категории: then у промисов, а также Intersection Observer.

В задачи отрисовки попадают задачи связанные с отрисовкой и обновлением контента страницы.

Мы можем наглядно рассмотреть как Event Loop делает решения о том какую задачу брать и выполнять первой.
1. Сначала Event Loop проверяет выполнились ли все синхронные задачи
2. Потом выполняются все задачи из микротасков
3. После выполнения всех микротасков - очередь очищается
4. Затем мы берем одну макрозадачу из списка и выполняем ее
5. После выполнения мы смотрим нужно ли нам сделать перерисовку страницы
6. Если перерисовать страницу нужно - делаем это
7. Все снова начинается с первого пункта

```
// setTimeout(function setTimeoutFn1() {
//     console.log('Timeout');
// }, 1000);
//
// console.log('End');
```


![img](https://media.licdn.com/dms/image/D4D12AQExWD31PDbNSQ/article-inline_image-shrink_1000_1488/0/1703925274829?e=1723680000&v=beta&t=aO-yxQ0s61QRZf3bhuqptU8Z2VTaKBzlxfEFO5IgLPQ)

Цепочка 

Движок JavaScript помещает setTimeout в  call stack, понимает, что это асинхронный код и перемещает его в Web Api.

Call stack становится пустой и event loop помещает туда console.log('End'), он выполняется и удаляется из сall stack, Call stack опять становится пустым.

В это время в Web Api проходит 1с - и очередь Макро тасков попадает коллбек из setTimeout. И так как Call stack пустой, то коллбек выполняется и удаляется из call stack.

